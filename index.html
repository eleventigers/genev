<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Genev.js</title>
        <meta name="description" content="Genetic image evolver library">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/harmotap.min.css">
    </head>
    <body>
        <style type="text/css">
            .padding--none {
                padding: 0;
            }
        </style>
        <a href="https://github.com/eleventigers/genev" target="_blank"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
        <div class="container">
            <h1>Genev.js</h1>
            <em>Genetic image evolver library, based on <a href="http://www.csse.monash.edu.au/~cema/evoeco/" target="_blank">EvoEco</a> by T. Kowaliw and J. McCormack and A. Dorin. Ongoing port by <a href="https://github.com/eleventigers" target="_blank">Jokubas Dargis</a>.</em>
            <h3>Interactive genetic selection</h3>
            <ul class="row">
                <li>You should see a population of four individuals initiated and being developed till they reach maturity</li>
                <li>Clicking on an individual will generate a new population based on your selection</li>
                <li>Long strings that appear in the text areas can be copied and pasted to generate a new individual based on a copied genome string</li>
                <li>If images do not seem to evolve to anything, refresh this page to regenerate the population</li>
            </ul>
            <div class="row col-span-10">
                <div class="col-span-3 js__individual padding--none"><textarea rows="8" class="js__indvidual-genome" style="resize:vertical;"></textarea></div>
                <div class="col-span-3 js__individual padding--none"><textarea rows="8" class="js__indvidual-genome" style="resize:vertical;"></textarea></div>
                <div class="col-span-3 js__individual padding--none"><textarea rows="8" class="js__indvidual-genome" style="resize:vertical;"></textarea></div>
                <div class="col-span-3 js__individual padding--none"><textarea rows="8" class="js__indvidual-genome" style="resize:vertical;"></textarea></div>
            </div>

        </div>

        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
        <script type="text/javascript" src="scripts/genev.min.js"></script>
        <script type="text/javascript">
            var genomes = ['{"options":{"useColor":true,"useSaturation":true,"width":188,"height":188,"maxAgents":5,"minAgents":1,"wrapAround":true,"agentTreeDepth":3,"numAgents":1},"startH":0.33358777360990644,"startS":0.16580975847318769,"startB":0.6801976226270199,"agents":[{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[24,2,22,25,14,22,6,18],"inputsS":[7,15,24,23,24,24,13,3],"inputsB":[17,3,3,26,19,7,11,11],"inputsDir":[25,18,17,2,11,7,16,5],"nodesH":["ind","ind","mult","incdec","div","incdec","realmean"],"nodesS":["incdec","atan","incdec","max","mult","incdec","inv"],"nodesB":["id","incdec","add","id","incdec","add","mult"],"nodesDir":["sub","sub","ind","sin","atan","mult","realmean"],"constArr":[0.9290854560676962,0.4223023122176528,0.8318161494098604,0.7530401933472604,0.8117438594345003,0.3554155910387635,0.5747651462443173],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":2}}]}',
            '{"options":{"useColor":true,"useSaturation":true,"width":188,"height":188,"maxAgents":3,"minAgents":1,"wrapAround":true,"agentTreeDepth":3,"numAgents":3},"startH":0.2442977309692651,"startS":0.2038848497904837,"startB":0.2793777291662991,"agents":[{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[25,26,15,6,14,1,20,7],"inputsS":[17,16,9,26,18,15,8,24],"inputsB":[9,12,22,22,15,9,6,15],"inputsDir":[5,10,16,11,9,10,21,9],"nodesH":["sub","min","ind","min","incdec","sub","incdec"],"nodesS":["id","id","id","atan","div","realmean","atan"],"nodesB":["incdec","min","realmean","div","add","div","id"],"nodesDir":["atan","incdec","min","incdec","mult","ind","mult"],"constArr":[0.268755552591756,0.15374402492307127,0.38878957787528634,0.7366960735525936,0.7360939960926771,0.4709966997615993,0.13230385212227702],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":3,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":1}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[21,21,16,19,26,2,3,12],"inputsS":[12,19,11,17,22,21,20,4],"inputsB":[3,21,1,20,18,13,3,1],"inputsDir":[23,8,18,19,23,3,6,3],"nodesH":["realmean","realmean","realmean","atan","div","atan","min"],"nodesS":["sub","atan","realmean","atan","realmean","incdec","ind"],"nodesB":["mult","atan","add","id","incdec","sin","sub"],"nodesDir":["incdec","add","incdec","max","realmean","add","sub"],"constArr":[0.7308882905635983,0.8997599317226559,0.5811022140551358,0.5026390100829303,0.3529606640804559,0.2950108938384801,0.5832113716751337],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":3,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":1}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[25,26,15,6,14,1,20,7],"inputsS":[17,16,9,26,18,15,8,24],"inputsB":[9,12,22,22,15,9,6,15],"inputsDir":[5,10,16,11,9,10,21,9],"nodesH":["sub","min","ind","min","incdec","sub","incdec"],"nodesS":["id","id","id","atan","div","realmean","atan"],"nodesB":["incdec","min","realmean","div","add","div","id"],"nodesDir":["atan","incdec","min","incdec","mult","ind","mult"],"constArr":[0.268755552591756,0.15374402492307127,0.38878957787528634,0.7366960735525936,0.7360939960926771,0.4709966997615993,0.13230385212227702],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":3,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":1}}]}',
            '{"options":{"useColor":true,"useSaturation":true,"width":188,"height":188,"maxAgents":5,"minAgents":1,"wrapAround":true,"agentTreeDepth":2,"numAgents":4},"startH":0.9160903845913708,"startS":0.24950305139645934,"startB":0.8699361828621477,"agents":[{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[11,10,10,17,7,10,11,14],"inputsS":[22,26,17,22,6,15,23,20],"inputsB":[19,1,19,20,5,12,4,21],"inputsDir":[7,12,16,25,18,23,22,11],"nodesH":["realmean","incdec","realmean","inv","incdec","realmean","incdec"],"nodesS":["ind","atan","mult","id","realmean","atan","atan"],"nodesB":["realmean","atan","sub","atan","realmean","sub","add"],"nodesDir":["atan","atan","id","min","ind","ind","id"],"constArr":[0.9770353140775114,0.5799278309568763,0.9850074765272439,0.770251584937796,0.0191810573451221,0.48722292529419065,0.600963965523988],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":2,"numAgents":2}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[21,3,21,22,23,11,21,12],"inputsS":[14,23,1,5,25,22,11,4],"inputsB":[7,6,3,20,19,9,8,26],"inputsDir":[21,22,4,21,21,15,19,24],"nodesH":["incdec","realmean","incdec","id","max","ind","sub"],"nodesS":["add","add","max","realmean","realmean","ind","realmean"],"nodesB":["realmean","mult","atan","sub","incdec","realmean","id"],"nodesDir":["atan","incdec","realmean","ind","incdec","realmean","sub"],"constArr":[0.7466160447802395,0.9478999525308609,0.577654215041548,0.9201026023365557,0.30438589700497687,0.49680683901533484,0.7818561135791242],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":2,"numAgents":2}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[11,10,10,17,7,10,11,14],"inputsS":[22,26,17,22,6,15,23,20],"inputsB":[19,1,19,20,5,12,4,21],"inputsDir":[7,12,16,25,18,23,22,11],"nodesH":["realmean","incdec","realmean","inv","incdec","realmean","incdec"],"nodesS":["ind","atan","mult","id","realmean","atan","atan"],"nodesB":["realmean","atan","sub","atan","realmean","sub","add"],"nodesDir":["atan","atan","id","min","ind","ind","id"],"constArr":[0.9770353140775114,0.5799278309568763,0.9850074765272439,0.770251584937796,0.0191810573451221,0.48722292529419065,0.600963965523988],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":2,"numAgents":2}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[21,3,21,22,23,11,21,12],"inputsS":[14,23,1,5,25,22,11,4],"inputsB":[7,6,3,20,19,9,8,26],"inputsDir":[21,22,4,21,21,15,19,24],"nodesH":["incdec","realmean","incdec","id","max","ind","sub"],"nodesS":["add","add","max","realmean","realmean","ind","realmean"],"nodesB":["realmean","mult","atan","sub","incdec","realmean","id"],"nodesDir":["atan","incdec","realmean","ind","incdec","realmean","sub"],"constArr":[0.7466160447802395,0.9478999525308609,0.577654215041548,0.9201026023365557,0.30438589700497687,0.49680683901533484,0.7818561135791242],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":2,"numAgents":2}}]}',
            '{"options":{"useColor":true,"useSaturation":true,"width":188,"height":188,"maxAgents":5,"minAgents":1,"wrapAround":true,"agentTreeDepth":3,"numAgents":2},"startH":0.17388349561952055,"startS":0.42184478929266334,"startB":0.8839277855586261,"agents":[{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[24,5,17,9,16,4,18,13],"inputsS":[13,5,6,3,1,8,18,9],"inputsB":[6,10,16,10,17,7,26,23],"inputsDir":[9,8,15,5,2,20,14,22],"nodesH":["mult","id","atan","inv","ind","atan","atan"],"nodesS":["id","atan","div","incdec","add","atan","atan"],"nodesB":["max","max","realmean","atan","id","atan","incdec"],"nodesDir":["incdec","atan","incdec","atan","mult","ind","atan"],"constArr":[0.1698437526356429,0.9590857841540128,0.7947708396241069,0.08188271499238908,0.18131724535487592,0.17139925295487046,0.5212300352286547],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":2}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[24,5,17,9,16,4,18,13],"inputsS":[13,5,6,3,1,8,18,9],"inputsB":[6,10,16,10,17,7,26,23],"inputsDir":[9,8,15,5,2,20,14,22],"nodesH":["mult","id","atan","inv","ind","atan","atan"],"nodesS":["id","atan","div","incdec","add","atan","atan"],"nodesB":["max","max","realmean","atan","id","atan","incdec"],"nodesDir":["incdec","atan","incdec","atan","mult","ind","atan"],"constArr":[0.1698437526356429,0.9590857841540128,0.7947708396241069,0.08188271499238908,0.18131724535487592,0.17139925295487046,0.5212300352286547],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":5,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":3,"numAgents":2}}]}',
            '{"options":{"useColor":true,"useSaturation":true,"width":188,"height":188,"maxAgents":4,"minAgents":1,"wrapAround":true,"agentTreeDepth":6,"numAgents":2},"startH":0.09921945119276643,"startS":0.7503584807273,"startB":0.5103470503818244,"agents":[{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[5,6,20,20,19,6,18,12],"inputsS":[21,16,15,15,21,9,20,19],"inputsB":[2,16,6,24,18,19,1,3],"inputsDir":[8,3,15,13,24,19,9,18],"nodesH":["id","id","realmean","id","realmean","mult","incdec"],"nodesS":["realmean","min","min","ind","max","mult","sin"],"nodesB":["max","min","realmean","div","mult","ind","realmean"],"nodesDir":["mult","atan","incdec","add","sub","realmean","incdec"],"constArr":[0.11208683392032981,0.8583435460459441,0.9835638378281146,0.49896602844819427,0.3551164227537811,0.39904474816285074,0.6048386287875473],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":4,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":6,"numAgents":2}},{"dir":0,"gen":0,"genTime1":0,"genTime2":0,"delay":0,"stop":1,"genome":{"inputsH":[4,1,11,1,5,8,16,10],"inputsS":[14,14,19,25,2,14,23,25],"inputsB":[15,6,1,7,8,11,22,11],"inputsDir":[2,25,15,12,13,3,25,9],"nodesH":["div","mult","realmean","add","realmean","atan","div"],"nodesS":["mult","ind","min","sin","id","realmean","incdec"],"nodesB":["realmean","min","atan","min","realmean","mult","ind"],"nodesDir":["sub","add","realmean","incdec","incdec","mult","incdec"],"constArr":[0.2724319414701313,0.35639915824867785,0.47825269191525877,0.9798321598209441,0.8023372062016279,0.011678039561957121,0.8269500862807035],"numTotalNodes":15,"numInputNodes":8,"numProcessNodes":7,"options":{"agentTreeDepth":3,"agentInputs":27,"biasHTree":false,"biasSTree":false,"biasBTree":false,"biasNoChange":false}},"options":{"width":188,"height":188,"wrapAround":true,"maxAgents":4,"useColor":true,"useSaturation":true,"minAgents":1,"agentTreeDepth":6,"numAgents":2}}]}'


            ];
        </script>
        <script type="text/javascript">
            $(function() {
                var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame,
                    views = prepCanvas('.js__individual'),
                    individuals = prepIndividuals( views ),
                    history = [];

                window.requestAnimationFrame = requestAnimationFrame;

                // prepSampleImage('img/puppy.jpg');

                setInterval(function(){
                    developIndividuals(individuals);
                }, 1);


                draw();

                _.each(individuals, function(ind, idx, l){
                    ind.view.$el.on('click', function(){
                        var die, toCross;
                        for(var i = 0; i < l.length; ++i){
                            if(i !== idx){
                                history.push(l[i].model);
                                die = Math.random();
                                if(die < 0.75){
                                    toCross = history[Math.floor(Math.random()*history.length)] || l[Math.floor(Math.random()*l.length)].model;
                                    l[i].model = l[idx].model.crossover(toCross);
                                } else {
                                    l[i].model = l[idx].model.mutate();
                                }
                            }
                            l[i].view.$el.parent().children('.js__indvidual-genome').html(l[i].model.toJSON());
                        }
                    });
                    ind.view.$el.parent().children('.js__indvidual-genome').on('change', function(){
                        var json = $(this).val();
                        ind.model = new Genev.Individual().fromJSON(json);
                    });
                });

                function developIndividuals( individuals ){
                     _.each(individuals, function(ind, idx, l){
                        ind.model.step( 200 );
                     });
                }

                function prepIndividuals( el ){
                    var individuals = [], ind;

                    el.each(function(){

                        ind = (Math.random() < 0.5) ? new Genev.Individual().fromJSON(genomes[Math.floor(Math.random()*genomes.length)]) : new Genev.Individual({options: {width: this.width, height: this.height, maxAgents: Math.round(Math.random()*3 + 3), minAgents: 1, agentTreeDepth: Math.round(Math.random() * 4 + 2)}});
                        individuals.push({
                            model: ind,
                            view: {
                                el: this,
                                $el: $(this),
                                ctx: this.getContext('2d')
                            }
                        });

                    });

                    return individuals;
                }

                function prepCanvas( selector ){
                    var $this, width, canvas, els;
                    els = $( selector );
                    els.map(function(){
                        $this = $(this),
                        width = $this.width(),
                        canvas = $('<canvas></canvas>');
                        canvas[0].width = width;
                        canvas[0].height = width;
                        return $this.prepend(canvas);
                    });
                    return els.children('canvas');
                }

                function prepSampleImage( url ){
                    var img = new Image();
                    img.onload = _.partial(onSampleImageLoaded, img);
                    img.src = url;
                }

                function onSampleImageLoaded( img ){
                    var canvas = $('<canvas></canvas>')[0],
                        ctx = canvas.getContext('2d'),
                        raw;

                   canvas.width = img.width;
                   canvas.height = img.height;
                   ctx.drawImage(img, 0, 0);
                   raw = ctx.getImageData(0, 0, img.width, img.height);

                   _.each(individuals, function( ind ){
                        ind.model.fromRGBA(raw.data);
                   });
                }

                function renderIndividuals( individuals ){
                    var raw;
                    _.each(individuals, function(ind, idx, l){
                        if(!ind.model.developed){
                            raw = ind.view.ctx.getImageData(0, 0, ind.model.options.width, ind.model.options.height);
                            raw.data.set(ind.model.getRGBA());
                            ind.view.ctx.putImageData(raw, 0, 0);
                        }
                    });
                }

                function draw() {
                    renderIndividuals( individuals );
                    requestAnimationFrame(draw);
                }

            });
        </script>

    </body>
</html>